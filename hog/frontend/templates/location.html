{% extends "_base.html" %}
{% load static %}
{% load humanize %}

{% block content %}
<script>
  var location_code = '{{ location.code }}';
  var hog_code = undefined;
  var min_date = {{ min_date }};
  var max_date = {{ max_date }};
  var initial_resolution = '{{ initial_resolution }}';
</script>

<script src="{% static 'main.js' %}"></script>


<div class="row">
  <h2>Location: {{ location.name }}</h2>
</div>




{% if num_measurements %}
 <div class="row">
   <div class="col-lg-6">
     <div class="card-wall">
       <div id="card-wall"><span id="loading">Loading...</span></div>
     </div>
   </div>
   <div class="col-lg-6">
     <div class="card" id="map"></div>
     <div class="measurement-chart" id="temp-container" style="width:100%; height:400px;">Loading...</div>
   </div>
 </div>

 {% else %}
 No measurements yet!
 {% endif %}
<script>
mapboxgl.accessToken = 'pk.eyJ1Ijoic2ViYmFjb24iLCJhIjoiY2ltdGYwZGJkMDA2a3Z3bTFucjgyZnlvdCJ9.hplRw1YZqso0DZNteF9S-g';
var bounds = [[-2.21541, 51.74051], [-2.20105, 51.74452]];
var map = new mapboxgl.Map({
  container: 'map',
  style: 'mapbox://styles/mapbox/streets-v9',
  bounds: bounds,
  fitBoundsOptions: { padding: 50 },
  minZoom: 11
});
map.addControl(new mapboxgl.NavigationControl());
$.getJSON("/api/locations/?code={{ location.code }}&format=json", function(data) {
data.results.forEach(function(box) {
    if(box.coords) {
      var coords = box.coords.coordinates;
      new mapboxgl.Marker()
        .setLngLat([coords[0], coords[1]])
      .addTo(map);
    } else {
       $('#map').html("No location information!");
    }
  });
});
</script>

{% endblock %}
